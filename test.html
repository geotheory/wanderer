<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<script src="//cdn.jsdelivr.net/npm/phaser@3.52.0/dist/phaser.js"></script>
<!-- <script src="https://cdn.jsdelivr.net/npm/phaser@3.52.0/dist/phaser-arcade-physics.min.js"></script> -->
</head>
<body>
<div id="game-area"></div>
<h3 style="left: 20px; top: 0px; position:absolute;">Mouse</h3>
<p id = 'mouse-report' style="left: 20px; top: 20px; position:absolute;">mouse report</p>
<h3 style="left: 400px; top: 0px; position:absolute;">Touch</h3>
<p id = 'touch-report' style="left: 400px; top: 20px; position:absolute;">touch report</p>

<script>

var config = {
    parent: 'game-area', type: Phaser.AUTO, width: 800, height: 600,
    backgroundColor: '#aaa', scene: { create: create, update: update }
}

var player;

function create () {
    var light_wall_graphics = this.add.graphics({ fillStyle: { color: 0xffff00 } });
    player = new Phaser.Geom.Rectangle( 400, 300, 50, 50 );
    player = light_wall_graphics.fillRectShape(player);
}

function update () {

    if ( Math.abs(d.x) > 10 ) {
        player.x += Math.sign(d.x) * 10;
        d = {x: 0, y: 0 };  // reset
    }

    if ( Math.abs(d.y) > 10 ) {
        player.y += Math.sign(d.y) * 10;
        d = {x: 0, y: 0 };
    }
}

var game = new Phaser.Game(config, 'game-area');

var p = { x: 0, y: 0 },
    d = { x: 0, y: 0 };

var em, et;
var mouse_down = false;

var target = document.getElementById('game-area'),
    mouse_report = document.getElementById('mouse-report'),
    touch_report = document.getElementById('touch-report');

document.body.addEventListener('mousedown',function(e){ mouse_down = true;})
document.body.addEventListener('mouseup',function(e){ mouse_down = false;})

document.body.addEventListener('mousemove',function(e){
    em = e;
    if(mouse_down){
        d.x += e.x - p.x;
        d.y += e.y - p.y;
        // mouse_report.innerText = d.x + ' ' + d.y;
        mouse_report.innerText = stringifyEvent(e);
        p.x = e.x;
        p.y = e.y;
    }
})

document.body.addEventListener('touchmove',function(e){
    touch_report.innerText = stringifyEvent(e);
    // et = e;
    // var touch = e.touches[0];
    // mouseX = touch.pageX;
    // mouseY = touch.pageY;
    // touch_report.innerText = mouseX + ' ' + mouseY;
})


function stringifyEvent(e) {
  const obj = {};
  for (let k in e) {
    obj[k] = e[k];
  }
  return JSON.stringify(obj, (k, v) => {
    if (v instanceof Node) return 'Node';
    if (v instanceof Window) return 'Window';
    return v;
  }, ' ');
}

</script>
</body>
</html>
